Create Database sql_casestudy1

use sql_casestudy1
 --CASE STUDY 1

select * from Location

select * from fact

Select * from product
--->
---> Display the number of States present in the location Table.
Select count(distinct State) from location

---> How Many products are of regular type.
Select product_type from product where type = 'Regular'
Select count(*) as Total_Product from Product where type = 'Regular'

---> How Much spending has been done on marketing of Product ID 1.
Select Sum(Marketing) as Total_marketing from fact where productID = 1

---> What is the Minimum sales of Product?
select min(sales) as Minimum_Sales from fact

---> Display the Maximum cost of Goods sold (COGS)
Select Max(COGS) as Max_COGS from fact

---> Display the details of Product where the Product type is Coffee?
Select * from Product where Product_type = 'Coffee'

---> Display the details where the total expense are greater then 40?
select * from fact where total_expenses > 40

---> What is the avaerage sales in area code 719?
select avg(sales) as Avg_sales from fact where Area_code = 719 

---> Find out the total profit generated by colorado?
Select Sum(Profit) as Total_profit from Fact F inner join Location L on F.Area_Code=L.Area_Code where State = 'Colorado'

---> Display the avaerage inventory from each Product ID?
Select Avg(Inventory) as Average_Inventory from Fact group by ProductID

---> Display State in a sequential Order in a Location Table?
Select Distinct State from Location Order by State

---> Display the average budget of the product where the average budget margin should be greater than 100?
Select Productid, Avg(Budget_profit) as Avg_Budget_Profit from fact group by ProductID having avg(Budget_margin)>100 

---> what is the total sales done on date 2010-01-01?
Select Sum(sales) as Total_Sales from Fact where date = '2010-01-01'

---> Display the average total expense of each product ID on an individual date?
Select date, ProductID, avg(Total_Expenses) as Avg_Total_Expense from Fact group by Date, ProductID Order by Date, ProductID 

---> display the table with the following attributes? such as date, product_ID, Product_type, product, sales, profit, state, area code
Select F.Date, F.ProductID, P.ProductID, P.Product_type, P.Product, F.Sales, F.Profit, L.State, L.Area_Code, F.Area_Code from Fact F 
inner join Product P on F.ProductID=P.ProductID
inner join Location L on F.Area_code=L.Area_code

---> Display the rank without any gap to show the sales wise rank?
Select dense_rank () over(Order by Sales desc) as Sales_rank from fact

---> Find the statewise profit and sales ?
Select L.State, sum(F.Profit) as Total_Profit, sum(F.Sales) as Total_sales from Fact F inner join Location L on F.Area_code=L.Area_code group by L.State

---> Find the State wise Profit and Sales along with the Product name?
Select L.State, P.Product, sum(F.Profit) as Total_profit, sum(F.Sales) as Total_sales from Fact f 
inner join Product P on F.ProductID=P.ProductID 
inner join Location L on F.Area_code=L.Area_code group by L.State, P.Product

---> If there is an increase in sales of 5% calculate the increased sales?
select ProductID, Sales, Sales * 1.05 as Increased_Sales from Fact 

---> Find the maximum profit along with the Product ID and Product type?
Select F.ProductID, P.ProductID, P.Product_Type,F.Profit from Fact F 
inner join Product P on F.ProductID = P.ProductID Order by F.Profit desc 

---> Create a Stored Procedure to fetch the results according to the product type from Product table?
Create Procedure get_products @Product_Type Varchar (50)
as
begin
select * from Product where Product_Type = @Product_Type
end 
exec get_products 'Coffee'

---> Write a query by creating a condition in which if the total expenses is less than 60 then it is a profit or else loss.
				SELECT 
					ProductID, 
					Total_Expenses,
					CASE 
						WHEN Total_Expenses < 60 THEN 'Profit'
						ELSE 'Loss'
					END AS 'Status'
			   FROM Fact

---> Give the total weekly sales value with the date and product ID details. Use roll-up to pull the data in hierarchical order.
				Select case 
				when Date is Null and ProductID is Null then 'GrandTotal'
				when ProductID is Null then 'SubTotal'
				else cast(ProductID as Varchar)
				end as ProductID_Display,
				Date, ProductID, Sum(sales) as Total_Weekly_Sales from Fact
				Group by Rollup (Date, ProductID) Order by Date, ProductID 
---ProductID Null Shows the SubTotal and Date and ProductID Null shows the Grand Total

---> Apply union and intersection operator on the tables which consist of attribute area code.
						Select Area_code, LocationID from Location
						Union
						Select Area_code, ProductID from Fact order by Area_code asc

---> Create a user-defined function for the product table to fetch aparticular product type based upon the userâ€™s preference.
					Create Function dbo.GetProductType(@Product_Type Varchar (50))
					Returns Varchar(255)
					as 
					begin
					Return (
					Select top 1 Product from Product
					where Product_Type = @Product_Type
					)
					end 
        select dbo.GetProductType ('Coffee') as ProductName

---> Change the product type from coffee to tea where product ID is 1and undo it.
					Begin Transaction
					Update Product
					Set Product_Type = 'Tea'
					WHERE ProductID = 1

					RollBack  -- to undo the change

---> Display the date, product ID and sales where total expenses are between 100 to 200.
				Select ProductId, Sales, Total_Expenses from Fact where Total_expenses between 100 and 200

---> Delete the records in the Product Table for regulartype.
				Delete from Product where Type = 'Regular'

---> Display the ASCII value of the fifth character from the column Product
					Select Product, ASCII(Substring(Product, 5, 1)) as FifthCharASCII
					From Product